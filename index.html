<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Algebrawesome — Équations du 1er degré 🎮</title>
  <meta name="description" content="Mini‑jeu pour apprendre à résoudre des équations du 1er degré pas à pas, plusieurs niveaux, en un seul fichier.">
  <style>
    :root{
      --bg:#0f1226; --card:#171a34; --ink:#e8ecff; --muted:#a9b0d9;
      --accent:#7c4dff; --accent2:#00e0b8; --bad:#ff5470; --good:#67f58f; --gold:#ffd166;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);
         background:radial-gradient(1200px 800px at 20% -10%,#1b1f47,transparent),radial-gradient(800px 600px at 120% 20%,#132a3a,transparent),var(--bg)}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:grid;place-items:center;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .logo span{font-weight:800;font-size:24px;color:white}
    h1{font-size:22px;margin:0;color:#fff}
    .pill{font-size:12px;background:#c7d2fe;border-radius:999px;padding:6px 10px;color:#1e1b4b;font-weight:700}
    .card{background:rgba(23,26,52,.7);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}

    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .equation{font-variant-numeric:tabular-nums;display:flex;align-items:center;justify-content:center;gap:8px;font-size:40px;font-weight:800;letter-spacing:1px;padding:24px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0))}
    .eq-small{font-size:16px;color:var(--muted)}
    .mascot{display:flex;gap:12px;align-items:center}
    .mascot-emoji{font-size:28px}

    .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .controls .row{display:flex;gap:8px;align-items:center}
    select,input[type=number]{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#111426;color:#e6eaff;width:100%}
    input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    button{cursor:pointer;border:0;border-radius:12px;padding:10px 14px;font-weight:800;color:#0b0f2f;background:linear-gradient(180deg,#dbeafe,#a5b4fc);box-shadow:0 6px 16px rgba(0,0,0,.25);transition:transform .06s ease}
    button:hover{transform:translateY(-1px)}
    button.secondary{background:linear-gradient(180deg,#ecfeff,#a7f3d0)}
    button.ghost{background:transparent;color:#dbeafe;border:1px dashed rgba(203,213,225,.4)}
    button.danger{background:linear-gradient(180deg,#fecaca,#fda4af)}

    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .muted{color:var(--muted)}

    .progress{display:flex;gap:8px;align-items:center}
    .bar{flex:1;height:10px;background:#0b0f2f;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.06)}
    .bar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent2),var(--accent));transition:width .5s ease}

    .levels{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    .lvl{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;text-align:center;cursor:pointer}
    .lvl h3{margin:6px 0 2px 0;font-size:16px}
    .lvl small{color:var(--muted)}
    .lvl.locked{opacity:.5;filter:grayscale(1);cursor:not-allowed}

    .history{height:220px;overflow:auto;padding:8px;background:rgba(0,0,0,.25);border-radius:12px;border:1px dashed rgba(255,255,255,.08)}
    .step{display:flex;justify-content:space-between;gap:8px;padding:6px 10px;border-radius:10px;margin-bottom:6px;background:rgba(255,255,255,.04)}

    .badge{display:inline-flex;align-items:center;gap:6px;background:rgba(124,77,255,.18);border:1px solid rgba(124,77,255,.35);padding:6px 9px;border-radius:999px}
    .stars{color:var(--gold)}

    .toast{position:fixed;inset:auto 0 20px 0;display:flex;justify-content:center;pointer-events:none}
    .toast>div{pointer-events:auto;background:#0b0f2f;color:#e7eaff;border:1px solid rgba(255,255,255,.08);padding:12px 16px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4)}

    .footer{margin-top:24px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo"><span>5</span></div>
        <div>
          <h1>Algebrawesome – Équations du 1er degré</h1>
          <div class="pill">Pas à pas · Fun · Multi‑niveaux</div>
        </div>
      </div>
      <div class="mascot"><span class="mascot-emoji">🖐️</span><div><strong>Quinto</strong><div class="muted" style="font-size:12px">Ton coach du nombre 5</div></div></div>
    </header>

    <section class="card" aria-label="progression">
      <div class="progress">
        <div class="badge">Progression : <span id="xp">0</span> XP</div>
        <div class="bar" aria-label="barre de progression"><span id="xpBar"></span></div>
        <div class="badge"><span class="stars" id="stars">☆☆☆</span></div>
      </div>
      <div class="toolbar" style="margin-top:10px">
        <button id="btnPractice" class="secondary">Mode Pratique</button>
        <button id="btnChallenge" class="ghost">Mode Défi</button>
        <button id="btnReset" class="danger" title="Effacer progression (session)">Réinitialiser</button>
      </div>
    </section>

    <div class="grid" style="margin-top:16px">
      <section class="card" aria-label="zone équation">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div class="levels" style="grid-template-columns:repeat(5, minmax(0,1fr));flex:1">
            <div class="lvl" data-level="1"><h3>Niveau 1</h3><small>x + a = b</small></div>
            <div class="lvl locked" data-level="2"><h3>Niveau 2</h3><small>a·x = b</small></div>
            <div class="lvl locked" data-level="3"><h3>Niveau 3</h3><small>a·x + b = c</small></div>
            <div class="lvl locked" data-level="4"><h3>Niveau 4</h3><small>(x + b)·a = c</small></div>
            <div class="lvl locked" data-level="5"><h3>Niveau 5</h3><small>(a·x + b)/d = e</small></div>
          </div>
          <button id="btnNew" style="margin-left:10px">Nouvelle équation</button>
        </div>
        <div class="equation" id="eqBox" aria-live="polite"></div>
        <div class="eq-small" id="eqHint">Astuce : fais la même opération des deux côtés ⚖️</div>
      </section>

      <section class="card" aria-label="zone actions">
        <h2 style="margin:0 0 8px 0;font-size:18px">Tes actions</h2>
        <div class="controls">
          <div class="row">
            <select id="op">
              <option value="add">Ajouter</option>
              <option value="sub">Soustraire</option>
              <option value="mul">Multiplier par</option>
              <option value="div">Diviser par</option>
            </select>
            <input id="value" type="number" step="1" value="1" />
          </div>
          <div class="row">
            <button id="apply">Appliquer aux 2 côtés</button>
            <button id="hint" class="ghost">Indice</button>
          </div>
        </div>
        <div class="toolbar">
          <button id="auto" class="secondary">Vérifier si c'est résolu</button>
          <button id="undo" class="ghost">Annuler</button>
        </div>
        <h3 style="margin:12px 0 6px 0;font-size:16px">Historique</h3>
        <div class="history" id="history" aria-live="polite"></div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h2 style="margin:0 0 8px 0;font-size:18px">Objectif pédagogique</h2>
      <ul>
        <li>Comprendre l'équilibre d'une équation : faire la <em>même</em> opération des deux côtés.</li>
        <li>Isoler la variable <strong>x</strong> à l'aide des opérations inverses (− ↔ +, × ↔ ÷).</li>
        <li>Simplifier et atteindre la forme <strong>x = nombre</strong>.</li>
      </ul>
      <p class="muted">Conseil de Quinto 🖐️ : élimine d'abord ce qui est <em>ajouté/soustrait</em> à x, puis ce qui est <em>multiplié/divisé</em>.</p>
    </section>

    <div class="footer">Fait avec ♡ pour l'apprentissage. Tout‑en‑un fichier HTML. — Sponsorisé par le nombre 5.</div>
  </div>

  <div class="toast" id="toast" hidden><div id="toastMsg">Bravo !</div></div>

  <script>
    // --------- Utilitaires fractions ---------
    const F = {
      gcd(a,b){a=Math.abs(a);b=Math.abs(b);while(b){[a,b]=[b,a%b]}return a||1},
      simp(n){if(n.q<0){n.p*=-1;n.q*=-1}if(n.p===0){n.q=1;return n}const g=this.gcd(n.p,n.q); n.p/=g; n.q/=g; return n},
      from(x){ if(Number.isInteger(x)) return {p:x,q:1}; const s=x.toString(); if(!s.includes('.')) return {p:x,q:1}; const d=s.split('.')[1].length; const q=10**d; return this.simp({p:Math.round(x*q),q}) },
      add(a,b){return this.simp({p:a.p*b.q + b.p*a.q, q:a.q*b.q})},
      sub(a,b){return this.simp({p:a.p*b.q - b.p*a.q, q:a.q*b.q})},
      mul(a,b){return this.simp({p:a.p*b.p, q:a.q*b.q})},
      div(a,b){if(b.p===0) throw Error('Division par 0'); return this.simp({p:a.p*b.q, q:a.q*b.p})},
      eq(a,b){return a.p===b.p && a.q===b.q},
      fmt(n){ if(n.q===1) return ''+n.p; const s=(n.p<0?'-':''); return s+Math.abs(n.p)+'/'+n.q },
      abs(n){return {p:Math.abs(n.p), q:n.q}},
    }

    // Modèle: a·x + b = c
    const Eq = {
      clone:E=>({a:{...E.a}, b:{...E.b}, c:{...E.c}}),
      render(E){
        const coef = F.eq(E.a, F.from(1))? '' : (F.eq(E.a, F.from(-1))? '-' : F.fmt(E.a)+'·')
        const sign = (E.b.p>=0?'+':'−')
        return `${coef}x ${sign} ${F.fmt(F.abs(E.b))} = ${F.fmt(E.c)}`
      },
      solved:E=> F.eq(E.b,F.from(0)) && !F.eq(E.a,F.from(0)),
      solution:E=> F.eq(E.a,F.from(0))? null : F.div(F.sub(E.c,E.b),E.a)
    }

    // Génération par niveaux -> retourne {a,b,c}
    function rInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}
    function pick(arr){return arr[Math.floor(Math.random()*arr.length)]}
    function genLevel(level){
      let a,b,c;
      switch(level){
        case 1: // x + a = b
          a=F.from(1); b=F.from(rInt(-9,9)); const x=F.from(rInt(-9,9)); c=F.add(F.mul(a,x),b); break;
        case 2: // a·x = b
          a=F.from(pick([2,3,4,5,-2,-3])); b=F.from(0); const x2=F.from(rInt(-9,9)); c=F.mul(a,x2); break;
        case 3: // a·x + b = c
          a=F.from(pick([2,3,4,5,-2,-3])); b=F.from(rInt(-9,9)); const x3=F.from(rInt(-9,9)); c=F.add(F.mul(a,x3),b); break;
        case 4: // (x+b)·a = c  (affiché ainsi mais même modèle)
          a=F.from(pick([2,3,4,5,-2,-3])); b=F.from(rInt(-9,9)); const x4=F.from(rInt(-9,9)); c=F.add(F.mul(a,x4),F.mul(a,b)); break;
        case 5: // (a·x+b)/d = e -> ax+b = d·e
          a=F.from(pick([2,3,5,-2,-3])); b=F.from(rInt(-9,9)); const d=F.from(pick([2,3,4])); const x5=F.from(rInt(-9,9));
          const e=F.simp(F.div(F.add(F.mul(a,x5),b),d)); c=F.mul(d,e); break;
        default: a=F.from(1); b=F.from(0); c=F.from(0);
      }
      return {a,b,c}
    }

    // --------- État (session only, pas de stockage) ---------
    const state = {
      mode:'practice', level:1, E:genLevel(1), history:[], steps:0, undo:[], bestForLevel:{}, xp:0
    }

    // --------- UI refs ---------
    const eqBox = document.getElementById('eqBox')
    const hist = document.getElementById('history')
    const opSel = document.getElementById('op')
    const valInp = document.getElementById('value')
    const btnApply = document.getElementById('apply')
    const btnNew = document.getElementById('btnNew')
    const btnHint = document.getElementById('hint')
    const btnAuto = document.getElementById('auto')
    const btnUndo = document.getElementById('undo')
    const btnReset = document.getElementById('btnReset')
    const btnPractice = document.getElementById('btnPractice')
    const btnChallenge = document.getElementById('btnChallenge')
    const xpEl = document.getElementById('xp'), xpBar=document.getElementById('xpBar'), starsEl=document.getElementById('stars')
    const toast = document.getElementById('toast'), toastMsg=document.getElementById('toastMsg')
    const levels = [...document.querySelectorAll('.lvl')]
    const eqHint = document.getElementById('eqHint')

    // --------- UI helpers ---------
    function showToast(msg){ toastMsg.textContent=msg; toast.hidden=false; setTimeout(()=>toast.hidden=true, 1700) }
    function updateEq(){ eqBox.textContent = Eq.render(state.E) }
    function pushHistory(text){ const div=document.createElement('div'); div.className='step'; div.innerHTML=`<span>${text}</span><span class="muted">${Eq.render(state.E)}</span>`; hist.prepend(div) }
    function renderHistory(){ hist.innerHTML=''; state.history.slice().reverse().forEach(t=>{ const d=document.createElement('div'); d.className='step'; d.innerHTML=`<span>${t}</span><span class="muted">${Eq.render(state.E)}</span>` }) }
    function setXP(x){ state.xp=Math.max(0,x); xpEl.textContent=state.xp; xpBar.style.width=Math.min(100,(state.xp%100))+'%'; }
    function award(stars){ starsEl.textContent='★'.repeat(stars)+'☆'.repeat(3-stars) }
    function unlockedMax(){ const best=state.bestForLevel; let max=1; for(let i=1;i<=5;i++){ if(best[i] && best[i].stars>=1) max=Math.max(max,i+1) } return Math.min(max,5) }
    function lockLevels(){ levels.forEach(el=>{ const lvl=Number(el.dataset.level); el.classList.toggle('locked', lvl>unlockedMax()) }) }
    function tipFor(){ const {a,b}=state.E; if(!F.eq(b,F.from(0))) return 'Indice : commence par éliminer ce qui est ajouté/soustrait à x.'; if(!F.eq(a,F.from(1))) return 'Indice : termine en divisant ou multipliant pour obtenir a=1.'; return 'Clique sur « Vérifier » pour valider x = nombre.' }

    function refresh(){ updateEq(); hist.innerHTML=''; lockLevels(); setXP(state.xp); const best=state.bestForLevel[state.level]||{}; award(best.stars||0); eqHint.textContent=tipFor() }

    // --------- Logique jeu ---------
    function apply(op, val){
      if(!Number.isFinite(val) || (op==='div' && val===0)) { showToast('Valeur non valide'); return }
      const k = F.from(val)
      const prev = Eq.clone(state.E)
      try{
        if(op==='add'){ state.E.b = F.add(state.E.b,k); state.E.c = F.add(state.E.c,k); state.history.unshift(`+ ${F.fmt(k)} des deux côtés`) }
        else if(op==='sub'){ state.E.b = F.sub(state.E.b,k); state.E.c = F.sub(state.E.c,k); state.history.unshift(`− ${F.fmt(k)} des deux côtés`) }
        else if(op==='mul'){ state.E.a = F.mul(state.E.a,k); state.E.b = F.mul(state.E.b,k); state.E.c = F.mul(state.E.c,k); state.history.unshift(`× ${F.fmt(k)} des deux côtés`) }
        else if(op==='div'){ state.E.a = F.div(state.E.a,k); state.E.b = F.div(state.E.b,k); state.E.c = F.div(state.E.c,k); state.history.unshift(`÷ ${F.fmt(k)} des deux côtés`) }
        state.undo.push(prev)
        state.steps++
        updateEq(); pushHistory(state.history[0])
        if(Eq.solved(state.E)) onSolved();
      }catch(e){ state.E=prev; showToast(e.message) }
    }

    function optimalSteps(E){ // heuristique ax+b=c -> (b!=0) + (a!=1)
      let s = (F.eq(E.b,F.from(0))?0:1) + (F.eq(E.a,F.from(1))?0:1); return Math.max(1,s)
    }

    function onSolved(){
      const sol = Eq.solution(state.E)
      showToast(`Bravo ! x = ${F.fmt(sol)} 🥳`)
      const opt = optimalSteps(state.E)
      const stars = state.steps<=opt?3 : state.steps<=opt+2?2 : 1
      award(stars)
      setXP(state.xp + 10*stars)
      const best = state.bestForLevel[state.level] || {stars:0,best:Infinity}
      if(stars>best.stars || state.steps<best.best){ state.bestForLevel[state.level]={stars,best:state.steps} }
      lockLevels()
    }

    function newEquation(){ state.E=genLevel(state.level); state.history=[]; state.steps=0; state.undo=[]; refresh() }

    function undo(){ if(!state.undo.length){ showToast('Rien à annuler'); return } state.E = state.undo.pop(); state.steps=Math.max(0,state.steps-1); updateEq(); showToast('Annulé') }

    // --------- Événements ---------
    btnApply.addEventListener('click', ()=> apply(opSel.value, Number(valInp.value)))
    btnNew.addEventListener('click', newEquation)
    btnHint.addEventListener('click', ()=> showToast(tipFor()))
    btnAuto.addEventListener('click', ()=>{ if(Eq.solved(state.E)){ onSolved() } else { const sol=Eq.solution(state.E); showToast(`Pas fini ! (Piste : x = ${F.fmt(sol)})`) } })
    btnUndo.addEventListener('click', undo)
    btnReset.addEventListener('click', ()=>{ Object.assign(state,{mode:'practice',level:1,E:genLevel(1),history:[],steps:0,undo:[],bestForLevel:{},xp:0}); refresh(); showToast('Session réinitialisée') })

    // niveaux cliquables
    levels.forEach(el=> el.addEventListener('click', ()=>{
      const lvl=Number(el.dataset.level)
      if(el.classList.contains('locked')){ showToast('Termine le niveau précédent pour le déverrouiller 🔒'); return }
      state.level=lvl; newEquation()
    }))

    // modes
    btnPractice.addEventListener('click', ()=>{ state.mode='practice'; btnPractice.className='secondary'; btnChallenge.className='ghost'; showToast('Mode Pratique') })
    btnChallenge.addEventListener('click', ()=>{ state.mode='challenge'; btnChallenge.className='secondary'; btnPractice.className='ghost'; showToast('Mode Défi : moins d’étapes = + d’étoiles ⭐') })

    // init
    newEquation()
  </script>
</body>
</html>
