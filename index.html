<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>تعلم حل المعادلات - لعبة دراجون بوكس</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f8ff;
      text-align: center;
      padding: 20px;
      margin: 0;
      direction: rtl;
    }
    h1 {
      color: #2c3e50;
    }
    .game-container {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .level {
      font-size: 1.2em;
      color: #e67e22;
      margin-bottom: 10px;
    }
    .equation {
      font-size: 2em;
      margin: 20px 0;
      padding: 15px;
      background: #e8f4fc;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .side {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .token {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .token:hover {
      transform: scale(1.1);
    }
    .btn {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1em;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn:hover {
      background: #2980b9;
    }
    .feedback {
      margin: 15px 0;
      font-weight: bold;
      min-height: 24px;
    }
    .hidden {
      display: none;
    }
    .win-screen {
      font-size: 1.5em;
      color: #27ae60;
    }
    .hint {
      color: #7f8c8d;
      font-size: 0.9em;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>🐉 لعبة تعلم المعادلات</h1>
    <p>اهدف إلى جعل الطرفين متساويين مع ترك <strong>x</strong> وحدها!</p>

    <div class="level">المستوى: <span id="level">1</span></div>
    <div class="equation">
      <div class="side" id="left"></div>
      <span>=</span>
      <div class="side" id="right"></div>
    </div>

    <div class="feedback" id="feedback"></div>
    <button class="btn" id="next-btn" onclick="nextLevel()">المستوى التالي</button>
    <button class="btn" id="reset-btn" onclick="resetLevel()">إعادة المحاولة</button>

    <div class="hint" id="hint"></div>
  </div>

  <script>
    let currentLevel = 1;
    const totalLevels = 8;
    const levels = [
      // المستوى 1: صور (كرات زرقاء وحمراء تلغي بعضها)
      { left: ['blue', 'red'], right: ['red'], solution: 'blue', type: 'visual' },
      // المستوى 2: صور + رمز x
      { left: ['x', 'blue'], right: ['green', 'green', 'green'], solution: ['green','green'], type: 'visual' },
      // المستوى 3: أرقام بسيطة
      { left: ['x', 3], right: [7], solution: 4, type: 'number' },
      // المستوى 4: x - a = b
      { left: ['x', -2], right: [5], solution: 7, type: 'number' },
      // المستوى 5: a + x = b
      { left: [4, 'x'], right: [9], solution: 5, type: 'number' },
      // المستوى 6: a - x = b
      { left: [8, '-x'], right: [3], solution: 5, type: 'number' },
      // المستوى 7: خليط
      { left: ['x', -5], right: [2], solution: 7, type: 'number' },
      // المستوى 8: تقييم نهائي
      { left: [6, 'x'], right: [13], solution: 7, type: 'number' }
    ];

    const colorMap = {
      blue: '#3498db',
      red: '#e74c3c',
      green: '#2ecc71',
      yellow: '#f1c40f'
    };

    const symbolMap = {
      'x': '🦄',
      '-x': '🐉',
      blue: '🔵',
      red: '🔴',
      green: '🟢',
      yellow: '🟡'
    };

    const nextBtn = document.getElementById('next-btn');
    const resetBtn = document.getElementById('reset-btn');
    const feedbackEl = document.getElementById('feedback');
    const hintEl = document.getElementById('hint');

    function initGame() {
      const levelData = levels[currentLevel - 1];
      document.getElementById('level').textContent = currentLevel;
      renderEquation(levelData);
      nextBtn.classList.add('hidden');
      feedbackEl.textContent = '';
      hintEl.textContent = getHint(levelData);
    }

    function renderEquation(levelData) {
      const leftEl = document.getElementById('left');
      const rightEl = document.getElementById('right');
      leftEl.innerHTML = '';
      rightEl.innerHTML = '';

      levelData.left.forEach(item => {
        const token = document.createElement('div');
        token.className = 'token';
        if (levelData.type === 'visual' && typeof item === 'string' && item !== 'x' && item !== '-x') {
          token.style.backgroundColor = colorMap[item];
        } else if (levelData.type === 'visual') {
          token.textContent = symbolMap[item] || item;
        } else {
          token.textContent = item;
        }
        token.onclick = () => handleTokenClick(item, levelData);
        leftEl.appendChild(token);
      });

      levelData.right.forEach(item => {
        const token = document.createElement('div');
        token.className = 'token';
        if (levelData.type === 'visual' && typeof item === 'string' && item !== 'x' && item !== '-x') {
          token.style.backgroundColor = colorMap[item];
        } else if (levelData.type === 'visual') {
          token.textContent = symbolMap[item] || item;
        } else {
          token.textContent = item;
        }
        token.onclick = () => handleTokenClick(item, levelData, true);
        rightEl.appendChild(token);
      });
    }

    function handleTokenClick(item, levelData, isRight = false) {
      if (typeof item === 'string' && (item === 'x' || item === '-x')) {
        feedback("لا يمكن إزالة x بهذه الطريقة. فكر كيف تجعل x وحدها!");
        return;
      }

      // نقل أو إزالة العنصر
      if (isRight) {
        levelData.right = levelData.right.filter(i => i !== item);
      } else {
        levelData.left = levelData.left.filter(i => i !== item);
      }

      // إزالة من الطرف الآخر (للتوازن)
      if (levelData.type === 'visual') {
        const opposite = getOppositeColor(item);
        const oppIndex = levelData.right.indexOf(opposite);
        if (oppIndex !== -1) {
          levelData.right.splice(oppIndex, 1);
        } else {
          // إذا لم يكن هناك مقابل، نضيفه كـ "سالب"
          levelData.right.push(opposite);
        }
      } else {
        // في الأرقام: نطرح نفس القيمة من الطرفين
        const value = item === '-x' ? 0 : (typeof item === 'number' ? item : 0);
        if (value !== 0) {
          // نبحث عن نفس الرقم في الطرف الآخر ونحذفه
          const idx = levelData.right.indexOf(value);
          if (idx !== -1) {
            levelData.right.splice(idx, 1);
          } else {
            levelData.right.push(-value);
          }
        }
      }

      renderEquation(levelData);
      checkWin(levelData);
    }

    function getOppositeColor(color) {
      const opposites = { blue: 'red', red: 'blue', green: 'yellow', yellow: 'green' };
      return opposites[color] || color;
    }

    function checkWin(levelData) {
      const left = levelData.left;
      const right = levelData.right;

      // التحقق من النصر
      if (left.length === 1 && left[0] === 'x' && right.length === 1 && right[0] === levelData.solution) {
        feedback("🎉 أحسنت! هذه هي الإجابة الصحيحة!", 'win');
        nextBtn.classList.remove('hidden');
      } else if (left.length === 1 && left[0] === '-x' && right.length === 1 && right[0] === -levelData.solution) {
        feedback("🎉 ناجح! لكن تذكّر: -x = -a تعني أن x = a", 'win');
        nextBtn.classList.remove('hidden');
      } else if (left.length === 0 && right.length === 0) {
        feedback("❗ أزلت كل شيء! تذكّر أن x يجب أن تبقى وحدها في اليسار.");
      } else if (left.length === 1 && left[0] === 'x') {
        const val = right[0];
        if (val === levelData.solution) {
          feedback("🎉 ناجح! x = " + val, 'win');
          nextBtn.classList.remove('hidden');
        } else {
          feedback("تقريباً! x = " + val + " لكن الجواب الصحيح هو " + levelData.solution);
        }
      }
    }

    function feedback(msg, type = 'normal') {
      feedbackEl.textContent = msg;
      if (type === 'win') {
        feedbackEl.style.color = '#27ae60';
      } else {
        feedbackEl.style.color = '#e74c3c';
      }
    }

    function getHint(levelData) {
      switch (currentLevel) {
        case 1:
          return "انقر على الألوان المتقابلة (الأحمر مع الأزرق) لإزالتها من الطرفين.";
        case 2:
          return "هدفك هو ترك الوحش (x) وحده في اليسار.";
        case 3:
          return "إذا كان x + 3 = 7، فكم يجب أن تكون x؟";
        case 4:
          return "x - 2 = 5 تعني أن x = 5 + 2.";
        default:
          return "احذف العدد بجانب x من الطرفين لتحصل على x = ...";
      }
    }

    function nextLevel() {
      if (currentLevel < totalLevels) {
        currentLevel++;
        initGame();
      } else {
        document.getElementById('left').innerHTML = "🎉";
        document.getElementById('right').innerHTML = "👏";
        feedback("لقد أتقنت حل المعادلات من الدرجة الأولى! أحسنت!", 'win');
        nextBtn.disabled = true;
        nextBtn.textContent = "اكتمل!";
      }
    }

    function resetLevel() {
      const levelData = JSON.parse(JSON.stringify(levels[currentLevel - 1]));
      levels[currentLevel - 1] = levelData;
      initGame();
    }

    // بدء اللعبة
    initGame();
  </script>
</body>
</html>
